<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#47AD45">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Einstellungen</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
    <div class="app-container">
	<button id="back-button" onclick="window.location.href='index.html'"><img class="menu-icon"  src="image/close.svg" alt="MenÃ¼" /></button>
        <h1>Einstellungen</h1>
        <button onclick="window.location.href='calculator.html'" style="margin-top: 10px; margin-bottom: 15px; padding: 10px; width: 100%; box-sizing: border-box;">BMI Rechner</button>
        
        <section id="user-data">
            <h5>User Data</h5>
            <button class="reset-log-btn" onclick="resetData()">Daten zurÃ¼cksetzen</button>
            <button class="reset-log-btn" onclick="resetDailyLog()">Tageslog zurÃ¼cksetzen</button>
            <button class="reset-log-btn" onclick="deleteAllProducts()">Produkte zurÃ¼cksetzen</button>
            <button onclick="resetAllData()" style="margin-top: 10px; background-color: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 4px;">Alle Daten lÃ¶schen</button>
        </section>

        <section id="appearance">
            <h5>Darstellung</h5>
            <button id="theme-toggle">ðŸŒ™</button>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Service Worker registrieren
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered', reg))
                    .catch(err => console.error('Service Worker registration failed', err));
            }

            // Dark Mode initialisieren
            const themeToggle = document.getElementById('theme-toggle');
            const currentTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            themeToggle.textContent = currentTheme === 'dark' ? 'â˜€' : 'ðŸŒ™';
            themeToggle.addEventListener('click', toggleTheme);

            // Vorhandenes bmiData laden - REMOVED
            // const bmiData = localStorage.getItem('bmiData');
            // if (bmiData) {
            //    const data = JSON.parse(bmiData);
            //    document.getElementById('height').value = data.height * 100 || '';
            //    document.getElementById('weight').value = data.weight || '';
            //    document.getElementById('age').value = data.age || '';
            //    document.getElementById('gender').value = data.gender || 'male';
            //    document.getElementById('activity').value = data.activity || '1.2';
            //    document.getElementById('goal').value = data.goal || 'maintain';
            //    const bmiResult = document.getElementById('bmi-result');
            //    let resultText = `Ihr BMI: ${data.bmi} - `;
            //    let bmiClass = '';
            //    const bmi = parseFloat(data.bmi);
            //    if (bmi < 18.5) {
            //        resultText += 'Untergewicht';
            //        bmiClass = 'underweight';
            //    } else if (bmi >= 18.5 && bmi <= 24.9) {
            //        resultText += 'Normalgewicht';
            //        bmiClass = 'normal';
            //    } else if (bmi >= 25 && bmi <= 29.9) {
            //        resultText += 'Ãœbergewicht';
            //        bmiClass = 'overweight';
            //    } else {
            //        resultText += 'Adipositas';
            //        bmiClass = 'obese';
            //    }
            //    bmiResult.textContent = resultText;
            //    bmiResult.className = `bmi-result ${bmiClass}`;
            //    bmiResult.style.display = 'block';
            //    document.getElementById('calorie-result').textContent = `Empfohlene Kalorien: ${data.recommendedCalories} kcal/Tag`;
            // }
        });

        // function calculateBMI() - REMOVED
        // { ... }

        function resetData() {
            localStorage.removeItem('bmiData');
            // document.getElementById('height').value = ''; // Field is not in this file
            // document.getElementById('weight').value = ''; // Field is not in this file
            // document.getElementById('age').value = ''; // Field is not in this file
            // document.getElementById('bmi-result').style.display = 'none'; // Element is not in this file
            // document.getElementById('calorie-result').textContent = ''; // Element is not in this file
            window.location.href = 'settings.html'; // ZurÃ¼ck zu settings.html
        }

        function resetDailyLog() {
            const today = new Date().toISOString().split('T')[0];
            const dailyFoodLog = JSON.parse(localStorage.getItem('dailyFoodLog') || '{}');
            delete dailyFoodLog[today];
            localStorage.setItem('dailyFoodLog', JSON.stringify(dailyFoodLog));
            localStorage.setItem('lastLogDate', today);
            window.location.href = 'index.html'; // ZurÃ¼ck zu index.html
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.getElementById('theme-toggle').textContent = newTheme === 'dark' ? 'â˜€' : 'ðŸŒ™';
        }
        
        function deleteAllProducts() {
            // This function was requested to be kept, assuming it exists or will be used.
            // If it's not defined elsewhere, it might cause an error if called.
            // For now, just ensuring it's not removed if it was there.
            // Placeholder for actual implementation if needed:
            // localStorage.removeItem('products'); // Example
             alert('deleteAllProducts function called - implement as needed');
        }


        function resetAllData() {
            if (confirm("MÃ¶chten Sie wirklich ALLE Daten unwiderruflich lÃ¶schen? Dies beinhaltet alle Produkte, BMI-Daten, den Tageslog und Theme-Einstellungen.")) {
                localStorage.clear();
                alert("Alle Daten wurden gelÃ¶scht. Die Seite wird neu geladen.");
                window.location.reload();
            }
        }
    </script>
</body>
</html>
